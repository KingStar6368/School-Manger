@{
    ViewData["Title"] = "بازیابی رمز عبور";
    Layout = "_Layout";
}

<div class="container-fluid d-flex justify-content-center align-items-center vh-100 bg-dark" dir="rtl">
    <div class="card bg-black text-white border-secondary" style="width: 100%; max-width: 500px;border-radius:20px">
        <div class="card-header bg-dark border-secondary d-flex justify-content-between align-items-center">
            <a asp-action="Index" class="btn btn-outline-light">
                <i class="bi bi-arrow-right"></i> بازگشت
            </a>
            <h5 class="m-0">بازیابی رمز عبور</h5>
        </div>

        <div class="card-body p-4">
            <form asp-action="ResetPassword" method="post" id="resetPasswordForm">
                <input type="hidden" name="token" value="@Context.Request.Query["token"]" />
                <input type="hidden" name="email" value="@Context.Request.Query["email"]" />

                <div class="mb-3">
                    <label for="newPassword" class="form-label">رمز عبور جدید</label>
                    <input type="password"
                           class="form-control bg-dark text-white border-secondary"
                           id="newPassword"
                           name="newPassword"
                           placeholder="رمز عبور جدید (حداقل ۸ کاراکتر)"
                           required
                           minlength="8">
                    <div id="newPasswordHelp" class="form-text">رمز عبور باید حداقل ۸ کاراکتر داشته باشد</div>
                </div>

                <div class="mb-3">
                    <label for="confirmPassword" class="form-label">تکرار رمز عبور جدید</label>
                    <input type="password"
                           class="form-control bg-dark text-white border-secondary"
                           id="confirmPassword"
                           name="confirmPassword"
                           placeholder="تکرار رمز عبور جدید"
                           required
                           minlength="8">
                    <div id="confirmPasswordHelp" class="form-text"></div>
                </div>

                <button type="submit" class="btn btn-primary w-100 py-2">تغییر رمز عبور</button>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const newPasswordInput = document.getElementById('newPassword');
            const confirmPasswordInput = document.getElementById('confirmPassword');
            const newPasswordHelp = document.getElementById('newPasswordHelp');
            const confirmPasswordHelp = document.getElementById('confirmPasswordHelp');

            // Validate new password
            newPasswordInput.addEventListener('input', function() {
                validatePassword(this, newPasswordHelp);
                validatePasswordMatch();
            });

            // Validate password confirmation
            confirmPasswordInput.addEventListener('input', validatePasswordMatch);

            function validatePassword(inputElement, helpElement) {
                if (inputElement.value.length < 8) {
                    inputElement.classList.remove('border-success', 'is-valid');
                    inputElement.classList.add('border-danger', 'is-invalid');
                    helpElement.textContent = 'رمز عبور باید حداقل ۸ کاراکتر داشته باشد';
                    helpElement.className = 'form-text text-danger';
                    return false;
                } else {
                    inputElement.classList.remove('border-danger', 'is-invalid');
                    inputElement.classList.add('border-success', 'is-valid');
                    helpElement.textContent = 'رمز عبور معتبر است';
                    helpElement.className = 'form-text text-success';
                    return true;
                }
            }

            function validatePasswordMatch() {
                const newPassword = newPasswordInput.value;
                const confirmPassword = confirmPasswordInput.value;

                if (confirmPassword.length === 0) {
                    confirmPasswordInput.classList.remove('border-success', 'border-danger', 'is-valid', 'is-invalid');
                    confirmPasswordHelp.textContent = '';
                    return false;
                }

                if (newPassword !== confirmPassword) {
                    confirmPasswordInput.classList.remove('border-success', 'is-valid');
                    confirmPasswordInput.classList.add('border-danger', 'is-invalid');
                    confirmPasswordHelp.textContent = 'رمزهای عبور مطابقت ندارند';
                    confirmPasswordHelp.className = 'form-text text-danger';
                    return false;
                } else if (newPassword.length >= 8) {
                    confirmPasswordInput.classList.remove('border-danger', 'is-invalid');
                    confirmPasswordInput.classList.add('border-success', 'is-valid');
                    confirmPasswordHelp.textContent = 'رمزهای عبور مطابقت دارند';
                    confirmPasswordHelp.className = 'form-text text-success';
                    return true;
                }
                return false;
            }

            // Form submission validation
            document.getElementById('resetPasswordForm').addEventListener('submit', function(e) {
                const isNewPasswordValid = validatePassword(newPasswordInput, newPasswordHelp);
                const isPasswordMatchValid = validatePasswordMatch();

                if (!isNewPasswordValid || !isPasswordMatchValid) {
                    e.preventDefault();

                    if (!isNewPasswordValid) {
                        newPasswordInput.focus();
                    } else if (!isPasswordMatchValid) {
                        confirmPasswordInput.focus();
                    }
                }
            });
        });
    </script>
}

<style>
    /* Persian font support */
    body {
        font-family: 'B Nazanin', 'Nazanin', 'Tahoma', sans-serif;
    }

    /* Validation states */
    .is-valid {
        border-color: #28a745 !important;
    }

    .is-invalid {
        border-color: #dc3545 !important;
    }

    .text-success {
        color: #28a745 !important;
    }

    .text-danger {
        color: #dc3545 !important;
    }

    /* Input focus styling */
    .form-control:focus {
        background-color: #222;
        color: white;
        box-shadow: 0 0 0 0.25rem rgba(100, 100, 100, 0.25);
    }

    /* Back button icon flip for RTL */
    .bi-arrow-right {
        transform: scaleX(-1);
    }
</style>